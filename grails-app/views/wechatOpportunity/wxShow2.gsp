<!DOCTYPE html><html lang="en"><head>    <meta name="layout" content="wechat"/>    <title>立即报单</title>    <style>    .report-bill .weui_cells_form .weui_cell {        padding-left: 25px;    }    .report-bill .weui_cell_hd label {        width: 7rem;    }    .sep-line {        border-top: 6px solid #f4f4ef;    }    .spouseInfo, .mortgageSum {        padding: 0 15px;    }    .requiredItem:before {        content: "*";        color: #CD001A;        position: absolute;        left: 15px;    }    .wxShow-warmTip {        padding: 15px 15px 0;        color: #9b9b9b;        font-size: 1rem;    }    .review-room{        background-color:#ffffff;        padding:0.5rem 1rem;        margin-bottom:0.5rem;    }    .review-room a{        color: #c13139;    }    .review-room span{        float:right;        color: #666666;    }    .declaration{        background-color:#ffffff;        padding:0.5rem 1rem;        color: #4484bc;    }    </style></head><body><header class="create-header">    <ul class="creat-flowList flex-box">        <li data-id="01" class="flex1 active">            <span></span>            <h3>借款信息</h3>        </li>        <li data-id="02" class="flex1">            <span></span>            <h3>上传材料</h3>        </li>        <li data-id="03" class="flex1">            <span></span>            <h3>报单成功</h3>        </li>    </ul></header><g:if test="${this.openId != null && this.openId != ''}">    <div class="review-room"><a href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx464de39cbfe33d14&redirect_uri=https%3A%2F%2Fs6f.zhongjiaxin.com%2FwechatOpportunity%2FwxIndex?stage=alreadyPF&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"><span> > </span>我已评房，请点此提交报单。</a></div></g:if><div class="report-bill">    <g:form action="wxUpload" name="reportBillForm">        <input name="id" id="id" value="${this.opportunity.id}" type="hidden">        <input name="openId" value="${this.openId}" type="hidden">        <g:if test="${this.openId != null && this.openId != ''}">            <div class="declaration">我直接报单，请完善如下信息。</div>        </g:if>        <div class="weui_cells weui_cells_form">            <div class="weui_cell">                <div class="requiredItem weui_cell_hd"><label class="weui_label">贷款金额</label></div>                <div class="weui_cell_bd weui_cell_primary">                    <g:field class="weui_input" type="number" id="requestedAmount" name="requestedAmount" value="" autofocus="autofocus"/>                </div>                <div class="weui_cell_hd">                    <label class="weui_label" style="margin-right: 0;text-align: right">（万元）</label>                </div>            </div>            <div class="weui_cell weui_cell_select">                <div class="requiredItem weui_cell_hd"><label class="weui_label">贷款期限</label></div>                <div class="weui_cell_bd weui_cell_primary">                    <g:select class="weui_select" name="loanDuration" id="loanDuration" noSelection="${['':'请选择']}"                        from="${["1", "2", "3", "4", "5","6", "7", "8", "9", "10","11", "12", "24", "36"]}" value="${this.opportunity?.loanDuration}"/>                </div>                <div class="weui_cell_hd">                    <label class="weui_label" style="margin-right: 25px;text-align: right">（月）</label>                </div>            </div>            %{--抵押类型--}%            <div class="weui_cell weui_cell_select" style="padding-left: 25px">                <div class="requiredItem weui_cell_hd"><label class="weui_label">抵押类型</label></div>                <div class="weui_cell_bd weui_cell_primary">                    <g:select class="weui_select" name="mortgageType.id" id="mortgageType" optionKey="id" optionValue="name"                              from="${com.next.MortgageType.list()}" value="${this.opportunity?.mortgageType}"/>                </div>            </div>            <div class="hide mortgageSum" id="fMortgageAmount">                <div class="weui_cell" style="border-top: 1px solid #ECECEC;padding-right: 0">                    <div class="weui_cell_hd requiredItem"><label class="weui_label">一抵金额</label></div>                    <div class="weui_cell_bd weui_cell_primary">                        <g:field class="weui_input" type="number" id="firstMortgageAmount" name="firstMortgageAmount"                                 value="${this.opportunity?.firstMortgageAmount}"/>                    </div>                    <div class="weui_cell_hd"><label class="weui_label"                                                     style="margin-right: 0;text-align: right">（万元）</label></div>                </div>            </div>            <div class="hide mortgageSum" id="sMortgageAmount">                <div class="weui_cell" style=" border-top: 1px solid #ECECEC;padding-right: 0">                    <div class="requiredItem weui_cell_hd"><label class="weui_label">二抵金额</label></div>                    <div class="weui_cell_bd weui_cell_primary">                        <g:field class="weui_input" type="number" id="secondMortgageAmount" name="secondMortgageAmount"                                 value="${this.opportunity?.secondMortgageAmount}"/>                    </div>                    <div class="weui_cell_hd"><label class="weui_label"                                                     style="margin-right: 0;text-align: right">（万元）</label></div>                </div>            </div>            <div class="hide mortgageSum" id="typeOfFirstMortgage">                <div class="weui_cell weui_cell_select" style=" border-top: 1px solid #ECECEC;padding-right: 0">                    <div class="requiredItem weui_cell_hd"><label class="weui_label">一抵性质</label></div>                    <div class="weui_cell_bd weui_cell_primary">                        <g:select class="weui_select" name="typeOfFirstMortgage.id" id="typeOfFirstMortgage"                                  from="${com.next.TypeOfFirstMortgage.list()}" optionKey="id" optionValue="name"                                  valueMessagePrefix="typeOfFirstMortgage"                                  value="${this.opportunity?.typeOfFirstMortgage}"/>                    </div>                </div>            </div>            %{--借款人信息--}%            <div id="borrowerInfo" class="sep-line">                <div class="weui_cell">                    <div class="requiredItem weui_cell_hd"><label class="weui_label">借款人姓名</label></div>                    <div class="weui_cell_bd weui_cell_primary">                        <g:textField class="weui_input" type="text" id="fullName" name="fullName" placeholder="输入真实姓名"                                     value="${this.opportunity?.fullName}"/>                    </div>                </div>                <div class="weui_cell weui_cell_select" style="padding-left: 25px">                    <div class="requiredItem weui_cell_hd"><label class="weui_label">借款人婚姻状态</label></div>                    <div class="weui_cell_bd weui_cell_primary">                        <g:select class="weui_select" name="maritalStatus" id="maritalStatus"                                  from="${["未婚", "已婚", "再婚", "离异", "丧偶"]}"                                  valueMessagePrefix="maritalStatus" value="${this.opportunity?.maritalStatus}"/>                    </div>                </div>            </div>            <div class="weui_cell">                <div class="weui_cell_hd"><label class="weui_label">借款人手机号</label></div>                <div class="weui_cell_bd weui_cell_primary">                    <g:field class="weui_input" type="number" id="cellphone" name="cellphone"                             placeholder="手机号报单可享延长保护期" value="${this.opportunity?.cellphone}"/>                </div>            </div>            <div class="weui_cell weui_cell_select">                <div class="requiredItem weui_cell_hd"><label class="weui_label"                                                              style="width: 12rem">借款人和抵押人是同一人</label></div>                <div class="weui_cell_bd weui_cell_primary">                    <select name="myGroup" class="weui_select" id="myGroup">                        <option value="1">是</option>                        <option value="0">否</option>                    </select>                </div>            </div>            %{--抵押人信息--}%            <div id="mortgagorInfo" class="hide">                <div class="weui_cell weui_cell_select" style="border-top: 1px solid #ECECEC">                    <div class="requiredItem weui_cell_hd"><label class="weui_label">抵押人婚姻状态</label></div>                    <div class="weui_cell_bd weui_cell_primary">                        <g:select class="weui_select" name="mortgagorMaritalStatus" id="mortgagorMaritalStatus"                                  from="${["未婚", "已婚", "再婚", "离异", "丧偶"]}"                                  valueMessagePrefix="mortgagorMaritalStatus" />                    </div>                </div>            </div>        </div>        <div class="wxShow-warmTip">            <h3 class="warm-tit" style="color: #9b9b9b;font-size: 1.2rem">温馨提示：</h3>            <p style="color:#4A4A4A;margin-bottom: 4px">                <span>完善借款人手机号，即可增加保护期时长，最长可达</span>                <span style="color:#ca61cd">15</span>天！            </p>            <h4>您当前的保护期时长                <span style="color:#CD001A" id="protectDay">10</span>                天！</h4>        </div>        <div class="bigBtn" style="margin-bottom: 20px">            <input class="linkBtn weui_btn weui_btn_plain_default" value="下一步" id="reportBillBtn" type="button"/>        </div>    </g:form></div><g:if test="${this.openId == null || this.openId == ''}">    <div class="hjwoo-hotline2">        <a href="tel:${this.opportunity?.contact?.city?.telephone}" class="hotline">            <g:img class="hotlineIcon" dir="images" file="hotline-icon.png"/>            <span class="city-hotline">${this.opportunity?.contact?.city?.telephone}</span>        </a>    </div></g:if>%{--提示信息和验证--}%<div class="message-box">    <div class="helpMsg hide"></div>    <g:if test="${flash.message}">        <div class="message" role="status">            ${flash.message}        </div>    </g:if>    <div class="row">        <g:hasErrors bean="${this.opportunity}">            <ul class="message" role="alert">                <g:eachError bean="${this.opportunity}" var="error">                    <li <g:if test="${error in org.springframework.validation.FieldError}">data-field-id="${error.field}"</g:if>><g:message                            error="${error}"/></li>                </g:eachError>            </ul>        </g:hasErrors>    </div></div><g:javascript>    $(function () {        // 页面初始化：借款人、抵押人是否为同一人        var mortgagorInfo = $("#mortgagorInfo");        $("#myGroup").change(function () {            var myGroup = $("#myGroup").val();            if (myGroup == 1) {                mortgagorInfo.hide();                $("#mortgagorMaritalStatus").val("");            } else {                mortgagorInfo.show();            }        });        // 抵押类型        var mortgageType = $("#mortgageType");        var fMortgageAmount = $("#fMortgageAmount");        var sMortgageAmount = $("#sMortgageAmount");        var typeOfFirstMortgage = $("#typeOfFirstMortgage");        // 页面初始化：抵押类型赋值        if (mortgageType.val() == 2 || mortgageType.val() == 3) {            fMortgageAmount.show();            typeOfFirstMortgage.show();        }        if (mortgageType.val() == 4) {            fMortgageAmount.show();            sMortgageAmount.show();            typeOfFirstMortgage.show();        }        mortgageType.change(function () {            $("#firstMortgageAmount").val("");            $("#secondMortgageAmount").val("");            if (mortgageType.val() == 1) {                fMortgageAmount.hide();                sMortgageAmount.hide();                typeOfFirstMortgage.hide();            }            if (mortgageType.val() == 2 || mortgageType.val() == 3) {                fMortgageAmount.show();                typeOfFirstMortgage.show();                sMortgageAmount.hide();            }            if (mortgageType.val() == 4) {                fMortgageAmount.show();                typeOfFirstMortgage.show();                sMortgageAmount.show();            }        });        $("#reportBillBtn").click(function () {            // 贷款金额            var requestedAmount = $("#requestedAmount").val().trim();            if (!requestedAmount) {                helpMessage("请输入贷款金额");                return;            }            if (requestedAmount <= 0) {                helpMessage("贷款金额必须大于零");                return;            }            if (!(/^-?[1-9]\d*$/.test(requestedAmount))) {                helpMessage("贷款金额必须为整数");                return;            }            // 贷款期限            var loanDuration = $("#loanDuration").val().trim();            if (!loanDuration) {                helpMessage("请输入贷款期限");                return;            }                        // 抵押类型:二抵金额            // 抵押类型            var firstMortgageAmount = $("#firstMortgageAmount").val().trim();            var secondMortgageAmount = $("#secondMortgageAmount").val().trim();            if (mortgageType.val() == 1) {                $("#firstMortgageAmount").val(0);                $("#secondMortgageAmount").val(0);            }            if (mortgageType.val() == 2 || mortgageType.val() == 3) {                if (!firstMortgageAmount) {                    helpMessage("请输入一抵金额");                    return;                }                if (firstMortgageAmount <= 0) {                    helpMessage("一抵金额必须大于零");                    return;                }                $("#secondMortgageAmount").val(0);            }            if (mortgageType.val() == 4) {                if (!firstMortgageAmount) {                    helpMessage("请输入一抵金额");                    return;                }                if (firstMortgageAmount <= 0) {                    helpMessage("一抵金额必须大于零");                    return;                }                if (!secondMortgageAmount) {                    helpMessage("请输入二抵金额");                    return;                }                if (secondMortgageAmount <= 0) {                    helpMessage("二抵金额必须大于零");                    return;                }            }            // 借款人姓名            var fullName = $("#fullName").val().trim();            if (!fullName) {                helpMessage("请输入借款人姓名");                return;            }            if (!(/^[\u2190-\u9fff]{1,10}$|^[\dA-Za-z]{1,20}$/.test(fullName))) {                helpMessage("借款人姓名格式不正确");                return;            }            // 借款人手机号            var cellphone = $("#cellphone").val().trim();            if (cellphone.length != 0 && !(/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/.test(cellphone))) {                helpMessage("请输入正确的借款人手机号");                return;            }            verifyProtectDay();            // $("#reportBillForm").submit();        });        setTimeout(function () {            $(".helpMsg").fadeOut(200);        }, 2000);        setTimeout(function () {            $(".message").fadeOut(200);        }, 2000);        // 验证借款人是否处于保护期        function verifyProtectDay() {            var requestedAmount = $("#requestedAmount").val().trim();            var loanDuration = $("#loanDuration").val().trim();            var fullName = $("#fullName").val().trim();            $.ajax({                type: "POST",                url: "https://" + window.location.host + "/wechatOpportunity/wxVerifyProtectDay",                data: {                    requestedAmount: requestedAmount,                    loanDuration: loanDuration,                    fullName: fullName                },                success: function (data) {                    if (data.status == "success") {                        if (data.flag == true) {                            helpMessage("借款人处于保护期，不可以报单");                            return;                        }else{                            $("#reportBillForm").submit();                        }                    }                }            });        }        function helpMessage(message) {            $(".helpMsg").text(message).fadeIn(200);            setTimeout(function () {                $(".helpMsg").fadeOut(200);            }, 2000);        }        // 动态显示保护期        $("#cellphone").blur(function () {            var phone = $("#cellphone").val()            if (phone.length != 0 && (/^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/.test(phone))) {                $("#protectDay").text(15);            } else {                $("#protectDay").text(10);            }        });    });</g:javascript></body></html>